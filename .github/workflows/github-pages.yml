name: Deploy Paketti GitHub Pages with Dark Mode

on:
  push:
    branches:
      - main

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      # Modify README.md for deployment (Inject Dark Mode)
      - name: Prepare README for Deployment
        run: |
          cp README.md README_DEPLOY.md  # Keep original file safe

          # Inject dark-mode.css at the top if it's not already there
          if ! grep -q 'dark-mode.css' README_DEPLOY.md; then
            echo '<link rel="stylesheet" href="/dark-mode.css">' | cat - README_DEPLOY.md > temp && mv temp README_DEPLOY.md
            echo "Injected dark-mode.css into README_DEPLOY.md"
          else
            echo "Dark mode CSS already exists in README_DEPLOY.md. Skipping injection."
          fi

          echo "========== DEBUG: Final README_DEPLOY.md =========="
          cat README_DEPLOY.md
          echo "=========================================="

      # Deploy README_DEPLOY.md to GitHub Pages
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: .
          enable_jekyll: true  # Ensure Markdown is converted properly
